{# templates/keys_home.html #}
{% extends "base.html" %}

{% block title %}Key Asset Tracker{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/keys_home.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4 keys-home">

  <div class="keys-home__header">
    <h2 class="keys-home__title">Key Page</h2>
  </div>

  <div class="keys-home__grid">

    <!-- Scan -->
    <div class="keys-home__card" id="scannerCard">
      <div class="keys-home__cardHeader">
        <h3>Scan a barcode</h3>
        <div class="keys-home__muted">Use the iPad camera to scan a key barcode.</div>
      </div>

      <div class="keys-home__cardBody">
        <button id="openScannerBtn" type="button" class="btn btn-primary w-100">
          Scan barcode
        </button>

        <div id="scannerPanel" class="keys-home__scanner" style="display:none;">
          <div class="keys-home__scannerTop">
            <div id="resultBox" class="keys-home__scannerResult">Scan a barcode…</div>
            <button id="closeScannerBtn" type="button" class="btn btn-outline-secondary">
              Close
            </button>
          </div>

          <video id="preview" playsinline></video>

          <div id="noCameraMsg" class="keys-home__error" style="display:none;">
            No camera devices detected.
          </div>
        </div>
      </div>
    </div>

    <!-- Search -->
    <div class="keys-home__card">
      <div class="keys-home__cardHeader">
        <h3>Find a key</h3>
        <div class="keys-home__muted">Search by keycode or address.</div>
      </div>

      <div class="keys-home__cardBody">
        <label for="keySearch" class="keys-home__label">Search</label>
        <input
          id="keySearch"
          class="keys-home__input"
          type="text"
          placeholder="Type at least 2 characters…"
          autocomplete="off"
        />
        <div class="keys-home__hint">Tip: You can paste an address fragment too.</div>

        <div id="searchResults" class="keys-home__results" style="display:none;"></div>
      </div>
    </div>

    <!-- Signed out -->
    <div class="keys-home__card">
      <div class="keys-home__cardHeader keys-home__cardHeader--status">
        <h3>Currently Signed Out</h3>
        <div class="keys-home__muted">Keys that are out right now, with who has them.</div>
      </div>

      <div class="keys-home__cardBody">
        <div id="signedOutLoading" class="keys-home__muted">Loading…</div>
        <div id="signedOutError" class="keys-home__error" style="display:none;"></div>
        <div id="signedOutList" class="keys-home__signedOutList"></div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_scripts %}
  <!-- ZXing Browser library -->
  <script src="https://unpkg.com/@zxing/browser@latest"></script>

  <script src="{{ url_for('static', filename='js/keys_home.js') }}"></script>
{% endblock %}
