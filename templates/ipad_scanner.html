{% extends "base.html" %}
{% block title %}iPad Scanner{% endblock %}

{% block extra_head %}
<!-- You can add page-specific CSS here -->
{% endblock %}

{% block content %}
<main class="wrapper" style="padding-top:2em">
    <section class="container" id="demo-content">
      <h1 class="title">ZXing Barcode Scanner</h1>
      <p>
        <a class="button-small button-outline" href="../../index.html">HOME üè°</a>
      </p>
      <p>Scan any supported 1D/2D code with ZXing javascript library from the device video
        camera.</p>
      <div>
        <a class="button" id="startButton">Start</a>
        <a class="button" id="resetButton">Reset</a>
      </div>
      <div>
        <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
      </div>
      <div id="sourceSelectPanel" style="display:none">
        <label for="sourceSelect">Change video source:</label>
        <select id="sourceSelect" style="max-width:400px">
        </select>
      </div>
      <label>Result:</label>
      <pre><code id="result"></code></pre>
    </section>
  </main>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="https://unpkg.com/@zxing/browser@latest"></script>
<script type="text/javascript">
window.addEventListener('load', async function () {

    console.log("üåê Page loaded.");

    const startBtn = document.getElementById("start-btn");
    const scannerContainer = document.getElementById("scanner-container");
    const videoElem = document.getElementById("video");

    const codeReader = new ZXingBrowser.BrowserMultiFormatReader();
    console.log("üì¶ ZXing initialized:", codeReader);

    try {
        const videoInputDevices = await codeReader.listVideoInputDevices();
        console.log("All input devices: ", videoInputDevices);
        if (videoInputDevices.length == 0){
            return;
        }

        const selectedDeviceId = videoInputDevices[0].deviceId;
        console.log(`Started decode from camera with id ${selectedDeviceId}`);

        const controls = await codeReader.decodeFromVideoDevice(selectedDeviceId, videoElem, (result, error, controls) => {
        // use the result and error values to choose your actions
        // you can also use controls API in this scope like the controls
        // returned from the method.
            if(result) {
                console.log("RESULT!");
            }
            if (error) {
                console.warn("Scan error: ", error);
            }
        });
        setTimeout(() => controls.stop(), 500);
    } catch (err){
        console.log(err)
    }
});
</script>
{% endblock %}

