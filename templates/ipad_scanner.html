{% extends "base.html" %}
{% block title %}iPad Scanner{% endblock %}

{% block extra_head %}
<!-- You can add page-specific CSS here -->
{% endblock %}

{% block content %}
<div class="container mt-4">

    <h2 class="text-center">iPad Barcode Scanner</h2>

    <button id="start-btn" class="btn btn-primary w-100 mt-3">Start Scanner</button>

    <div id="scanner-container" 
        style="display:none; margin-top:20px; position:relative;">
        <video id="video" style="width:100%; border-radius:10px;" playsinline></video>

        <div id="scanner-overlay"
            style="position:absolute; top:0; left:0; right:0; bottom:0; border:3px solid rgba(0,255,0,0.4);">
        </div>
    </div>

    <p id="message" class="text-center mt-3 text-muted">
        Tap ‚ÄúStart Scanner‚Äù to begin.
    </p>

</div>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="https://unpkg.com/@zxing/browser@latest"></script>
<script type="text/javascript">
window.addEventListener('load', async function () {

    console.log("üåê Page loaded.");

    const startBtn = document.getElementById("start-btn");
    const scannerContainer = document.getElementById("scanner-container");
    const videoElem = document.getElementById("video");

    const codeReader = new ZXingBrowser.BrowserQRCodeReader();
    console.log("üì¶ ZXing initialized:", codeReader);

    try {
        const videoInputDevices = await ZXingBrowser.BrowserCodeReader.listVideoInputDevices();
        const selectedDeviceId = videoInputDevices[0].deviceId;
        console.log(`Started decode from camera with id ${selectedDeviceId}`);

        

        const controls = await codeReader.decodeFromVideoDevice(selectedDeviceId, videoElem, (result, error, controls) => {
        // use the result and error values to choose your actions
        // you can also use controls API in this scope like the controls
        // returned from the method.
            if(result) {
                console.log("RESULT!");
            }
            if (error) {
                console.warn("Scan error: ", error);
            }
        });
    } catch (err){
        console.log(err)
    }
});
</script>
{% endblock %}

